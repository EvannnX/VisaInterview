# 自选题目功能说明

## 📝 功能概述

新增**自选题目**功能，支持老师/学员自己选择题目或输入自定义中文问题，系统自动翻译成英文进行面试。

---

## 🎯 两种面试模式

### 1. 🎲 随机抽题模式（原有功能）

**适用场景**：快速练习、模拟真实面试

**操作流程**：
1. 选择签证类型
2. 选择面试官口音
3. 选择题目数量（5/10/15/20）
4. 开始面试

**特点**：
- 系统从题库随机抽取
- 保证题目多样性
- 快速开始

---

### 2. ✏️ 自选题目模式（新功能）

**适用场景**：针对性训练、老师出题、自测特定问题

**操作流程**：
1. 选择签证类型
2. 选择面试官口音
3. 选择面试模式：「自选题目」
4. 两种方式添加题目：
   - **从题库选择**：浏览并勾选题目
   - **自定义输入**：输入中文问题
5. 开始面试

**特点**：
- 完全自主控制题目
- 支持中文输入，自动翻译
- 可混合使用题库和自定义题目
- 实时显示已选题目数量

---

## 🌟 核心功能详解

### 📚 从题库选择

```
界面展示：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 从题库选择 (3 题已选)

☐ Why do you want to visit the United States?
  难度: 中等 | 主题: GENERAL

☑ Can you show me your financial documents?
  难度: 困难 | 主题: FINANCIAL

☑ How long do you plan to stay?
  难度: 简单 | 主题: TRAVEL

☑ Why should I believe you will return?
  难度: 困难 | 主题: INTENT
  
  ... 更多题目 ...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**功能**：
- 显示所选签证类型的所有题目
- 支持多选（复选框）
- 显示题目难度和主题
- 实时统计已选数量
- 最多可浏览 500 道题

---

### ✍️ 自定义输入题目

```
界面展示：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✏️ 自定义题目 (2 题)

┌──────────────────────────────────┐
│ 输入中文问题，系统会自动翻译成英文  │  [+ 添加]
└──────────────────────────────────┘

已添加的题目：

📝 你为什么要去美国旅游？              [× 删除]
📝 你的工作是什么？收入多少？          [× 删除]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**功能**：
- 输入中文问题
- 按回车或点击「+」添加
- 可以删除已添加的题目
- 系统会自动翻译成英文
- 支持任意数量的自定义题目

**翻译示例**：
- 输入：`你为什么要去美国旅游？`
- 翻译：`Why do you want to travel to the United States?`

---

### 📊 实时统计

```
✅ 已准备：共 5 道题目，预计用时 8 分钟

   • 从题库选择：3 题
   • 自定义输入：2 题
```

**功能**：
- 实时显示总题目数
- 自动计算预计用时（每题 1.5 分钟）
- 区分题库和自定义题目
- 智能验证（至少选择一题）

---

## 🌐 智能翻译系统

### 翻译方式

#### 方式一：OpenAI GPT 翻译（推荐）

**配置方法**：
```bash
# 在 .env 文件中添加
OPENAI_API_KEY=sk-your-api-key-here
```

**特点**：
- ✅ 智能翻译，符合签证官提问风格
- ✅ 语法自然，符合英语习惯
- ✅ 自动调整语气和表达
- ✅ 支持复杂句式

**翻译示例**：
```
输入：你的银行账户里的钱是从哪来的？最近为什么突然存入大笔金额？
翻译：Where did the money in your bank account come from? 
     Why was a large amount suddenly deposited recently?
```

#### 方式二：占位符提示（未配置时）

如果未配置 OpenAI API Key：
```
输入：你为什么要去美国？
输出：[Please translate to English] 你为什么要去美国？
```

**提示**：建议配置 OpenAI API 以获得最佳体验。

---

## 🎬 使用场景

### 👨‍🏫 场景一：老师针对性出题

**需求**：学员在财务问题上表现不佳，需要重点训练

**操作**：
1. 选择「自选题目」模式
2. 从题库中筛选所有财务相关题目：
   - ☑ Can you show me your financial documents?
   - ☑ How much money do you have in your bank account?
   - ☑ Who is sponsoring your trip?
   - ☑ Where did this large deposit come from?
3. 添加自定义追问：
   - "你的收入和银行余额匹配吗？"
   - "这笔钱够你在美国的开销吗？"
4. 开始针对性训练

**效果**：15 道财务相关题目，深度训练，预计 23 分钟

---

### 👤 场景二：学员自测薄弱环节

**需求**：学员担心回答不好"为什么会回国"的问题

**操作**：
1. 选择「自选题目」模式
2. 输入中文问题：
   - "你为什么一定会回国？"
   - "你在美国有亲戚，为什么不留下来？"
   - "很多人去了美国就不回来了，你呢？"
   - "你的专业在美国工资很高，为什么要回国？"
3. 开始面试

**效果**：4 道高度针对性问题，预计 6 分钟

---

### 🎯 场景三：混合训练

**需求**：既要覆盖全面，又要重点突破

**操作**：
1. 选择「自选题目」模式
2. 从题库选择基础题目（5题）：
   - 自我介绍
   - 旅行目的
   - 行程安排
   - 财务状况
   - 工作背景
3. 添加自定义刁钻问题（3题）：
   - "你的回答和申请表上的信息不一致，为什么？"
   - "我看你很紧张，是不是有什么隐瞒的？"
   - "你的理由听起来不太可信，能再解释一下吗？"
4. 开始面试

**效果**：8 道题，基础 + 压力测试，预计 12 分钟

---

## 🔧 技术实现

### 前端

**文件**：`app/(student)/interview/new/page.tsx`

**主要功能**：
- 模式切换（随机/自选）
- 题目浏览和多选
- 自定义题目输入
- 实时统计和验证

**关键状态**：
```typescript
const [interviewMode, setInterviewMode] = useState<'random' | 'custom'>('random');
const [availableQuestions, setAvailableQuestions] = useState<any[]>([]);
const [selectedQuestions, setSelectedQuestions] = useState<string[]>([]);
const [customQuestions, setCustomQuestions] = useState<string[]>([]);
```

---

### 后端

**文件**：`app/api/interview/start/route.ts`

**主要功能**：
1. 接收面试配置
2. 处理两种模式：
   - 随机模式：从题库随机抽取
   - 自定义模式：
     - 获取选中的题库题目
     - 翻译自定义中文题目
     - 创建临时题目记录
3. 创建面试会话
4. 返回面试数据

**翻译函数**：
```typescript
async function translateToEnglish(chineseText: string): Promise<string> {
  if (process.env.OPENAI_API_KEY) {
    // 使用 OpenAI GPT-3.5 翻译
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'gpt-3.5-turbo',
        messages: [
          {
            role: 'system',
            content: 'Translate to English as a visa officer would ask...',
          },
          {
            role: 'user',
            content: chineseText,
          },
        ],
      }),
    });
    // 返回翻译结果
  }
  // 未配置时返回占位符
  return `[Please translate to English] ${chineseText}`;
}
```

---

## ⚙️ 配置指南

### 1. 不使用翻译功能

**适用场景**：只使用题库题目，不输入自定义题目

**配置**：无需任何配置

**使用**：
- 选择「自选题目」模式
- 只从题库中选择题目
- 不输入自定义题目

---

### 2. 使用 OpenAI 翻译（推荐）

**步骤**：

1. **获取 OpenAI API Key**
   - 访问：https://platform.openai.com/api-keys
   - 注册并创建 API Key

2. **配置环境变量**
   ```bash
   # 编辑 .env 文件
   nano .env
   
   # 添加以下行
   OPENAI_API_KEY=sk-your-api-key-here
   ```

3. **重启应用**
   ```bash
   # 如果使用 Docker
   docker-compose restart
   
   # 如果使用 npm
   npm run dev
   ```

4. **测试翻译**
   - 进入「自选题目」模式
   - 输入中文问题：`你为什么要去美国？`
   - 提交后，系统会自动翻译

---

### 3. 使用其他翻译 API

可以修改 `app/api/interview/start/route.ts` 中的 `translateToEnglish` 函数：

```typescript
// 使用 Google Translate API
// 使用 Azure Translator
// 使用 DeepL API
// 等等...
```

---

## 📊 数据流程

```
用户操作
   ↓
选择面试模式
   ↓
┌──────────┬──────────┐
│ 随机模式  │ 自选模式  │
└──────────┴──────────┘
     ↓           ↓
 随机抽题    ├─ 从题库选择
     ↓       └─ 输入自定义题目
     │               ↓
     │          翻译成英文
     │               ↓
     │          创建临时题目
     ↓               ↓
   创建面试会话 ←────┘
         ↓
   开始英文面试
```

---

## ✅ 已修复问题

### 1. 录音按钮位置

**问题**：录音按钮跑到左边了

**修复**：
```tsx
// 之前
<div className="mb-6">
  <button ...>

// 修复后
<div className="flex justify-center mb-6">
  <button ...>
```

**效果**：录音按钮现在居中显示

---

## 🎉 功能优势

### 对比传统方式

| 功能 | 传统方式 | 自选题目功能 |
|------|---------|------------|
| 题目选择 | ❌ 只能随机 | ✅ 完全自主 |
| 自定义题目 | ❌ 不支持 | ✅ 支持中文输入 |
| 针对性训练 | ❌ 难以实现 | ✅ 完美支持 |
| 老师出题 | ❌ 需要手动添加 | ✅ 直接选择或输入 |
| 翻译支持 | ❌ 无 | ✅ AI 智能翻译 |
| 混合使用 | ❌ 不支持 | ✅ 题库+自定义 |

---

## 📱 界面预览

### 模式选择

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
面试模式

┌────────────────┐  ┌────────────────┐
│  🎲 随机抽题    │  │ ✏️ 自选题目     │
│  系统从题库中   │  │ 从题库选择或    │
│  随机抽取题目   │  │ 自己输入题目    │
└────────────────┘  └────────────────┘
     （未选中）         （已选中）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 题目选择界面

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 从题库选择 (3 题已选)

┌─────────────────────────────────┐
│ ☑ Why do you want to visit...   │
│   难度: 中等 | 主题: GENERAL      │
│                                 │
│ ☐ Can you show me your...       │
│   难度: 困难 | 主题: FINANCIAL    │
│                                 │
│ ☑ How long do you plan...       │
│   难度: 简单 | 主题: TRAVEL       │
└─────────────────────────────────┘

✏️ 自定义题目 (2 题)

┌──────────────────────────┬─────┐
│ 输入中文问题...           │ [+] │
└──────────────────────────┴─────┘

📝 你为什么要去美国？          [×]
📝 你有移民倾向吗？            [×]

✅ 已准备：共 5 道题目，预计用时 8 分钟

             [取消]  [开始面试]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🚀 立即使用

### 快速开始

1. **访问页面**
   ```
   http://localhost:3000/interview/new
   ```

2. **选择自选模式**
   - 点击「✏️ 自选题目」

3. **添加题目**
   - 从题库勾选题目
   - 或输入中文问题

4. **开始面试**
   - 点击「开始面试」
   - 进入纯英文面试环境

---

## 💡 使用建议

### 对于老师

1. **课前准备**
   - 根据教学内容选择题目
   - 添加针对性追问
   - 创建多个场景练习

2. **课中使用**
   - 快速创建定制面试
   - 实时调整题目难度
   - 针对学员薄弱环节

3. **课后作业**
   - 布置特定题目练习
   - 要求学员自测并提交报告

### 对于学员

1. **自我诊断**
   - 输入担心的问题
   - 测试自己的应对能力
   - 反复练习直到流畅

2. **模拟真实场景**
   - 选择曾被问过的问题
   - 模拟签证官追问
   - 训练临场反应

3. **系统学习**
   - 按主题选择题目
   - 逐个突破
   - 全面提升

---

## 📞 技术支持

**文档**：
- 快速启动指南：`快速启动指南.md`
- 系统状态报告：`系统状态报告.md`
- 面试英文化说明：`面试页面英文化说明.md`

**常见问题**：

Q: 自定义题目不翻译怎么办？
A: 请在 .env 中配置 OPENAI_API_KEY

Q: 可以同时使用题库和自定义题目吗？
A: 可以！两种方式可以混合使用

Q: 最多可以选择多少道题目？
A: 没有上限，但建议 5-20 题为宜

Q: 翻译的英文不准确怎么办？
A: OpenAI 翻译已经非常准确，如需调整可以直接修改题库

---

**最后更新**: 2025-09-30  
**版本**: v1.1.0  
**状态**: ✅ 已上线并测试完成

🎉 **享受全新的自选题目功能，让面试训练更高效！**
