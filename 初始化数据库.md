# 🗄️ 初始化数据库 - 添加测试数据

## 📋 概述

Vercel 部署成功后，数据库表结构已经创建（通过 Prisma migrations），但是还没有任何数据。

我们需要运行 seed 脚本来添加：
- 👤 测试用户（管理员和学生）
- 📚 221 道面试题目

---

## ✅ 前提条件

在运行 seed 之前，确保：
- ✅ Vercel 部署已完成
- ✅ 部署状态显示 "Ready"
- ✅ 没有构建错误

---

## 🚀 方法 1：本地运行 Seed（推荐）

### 步骤 1：设置数据库连接

在终端中运行：

```bash
export DATABASE_URL="postgresql://postgres:TCGaTwstfLkQsVHnBoRbJPqoYeeQoSJA@shortline.proxy.rlwy.net:36230/railway"
```

### 步骤 2：运行 Seed 脚本

有三个 seed 脚本可选：

#### 选项 A：基础 Seed（推荐，最快）
```bash
npx prisma db seed
```

这会添加：
- 2 个测试用户
- 约 30 道基础题目

#### 选项 B：完整 150 题
```bash
npx tsx prisma/seed-150.ts
```

这会添加：
- 150 道高质量题目
- 覆盖所有签证类型

#### 选项 C：150 题 + 60 道 B1/B2 进阶题
```bash
# 先运行 150 题
npx tsx prisma/seed-150.ts

# 然后添加 B1/B2 进阶题
npx tsx prisma/seed-b1b2-advanced.ts
```

这会添加：
- 总共 221 道题目
- 包含大量 B1/B2 刁钻问题

---

### 推荐执行顺序：

```bash
# 1. 设置数据库连接
export DATABASE_URL="postgresql://postgres:TCGaTwstfLkQsVHnBoRbJPqoYeeQoSJA@shortline.proxy.rlwy.net:36230/railway"

# 2. 运行基础 seed（添加用户 + 基础题目）
npx prisma db seed

# 3. 添加 150 题
npx tsx prisma/seed-150.ts

# 4. 添加 B1/B2 进阶题
npx tsx prisma/seed-b1b2-advanced.ts
```

---

## 📊 Seed 完成后的数据

### 用户账号：

**管理员账号**
```
邮箱：admin@example.com
密码：Admin@123
```

**学生账号**
```
邮箱：student@example.com
密码：Student@123
```

### 题目分布：

- F1 学生签证：约 50 题
- H1B 工作签证：约 40 题
- B1/B2 旅游签证：约 80 题（含进阶）
- J1 交流签证：约 30 题
- L1 调动签证：约 21 题

**总计：221 道题目**

---

## 🐛 常见问题

### Q: 报错 "P2002: Unique constraint failed"
**A:** 数据已存在。可以：
1. 忽略（数据已经导入过了）
2. 或清空数据库重新导入：
   ```bash
   npx prisma migrate reset
   npx prisma db seed
   ```

### Q: 报错 "Can't reach database"
**A:** 检查 DATABASE_URL 是否正确设置：
```bash
echo $DATABASE_URL
```

### Q: 报错 "command not found: tsx"
**A:** 安装 tsx：
```bash
npm install -g tsx
```

### Q: Seed 运行很慢
**A:** 这是正常的，添加 221 道题目可能需要 30-60 秒。耐心等待。

---

## ✅ 验证数据导入成功

### 方法 1：通过网站验证

1. 访问：https://visa-interview.vercel.app
2. 使用管理员账号登录：
   - admin@example.com / Admin@123
3. 进入题库管理
4. 检查题目数量是否正确

### 方法 2：通过 Prisma Studio（可选）

```bash
# 设置数据库连接
export DATABASE_URL="postgresql://postgres:TCGaTwstfLkQsVHnBoRbJPqoYeeQoSJA@shortline.proxy.rlwy.net:36230/railway"

# 打开 Prisma Studio
npx prisma studio
```

在浏览器中查看：
- User 表：应该有 2 条记录
- Question 表：应该有 221 条记录

---

## 🎯 完成检查清单

运行 seed 后，确认：

- [ ] Seed 脚本执行成功（没有错误）
- [ ] 可以使用测试账号登录网站
- [ ] 管理后台可以看到题目
- [ ] 学生端可以开始面试

---

## 📞 需要帮助？

如果遇到问题：
1. 复制错误信息
2. 告诉我你运行的命令
3. 我会帮你解决！

---

## 🚀 下一步

数据库初始化完成后：
1. ✅ 测试登录功能
2. ✅ 测试面试流程
3. ✅ 测试语音功能（ElevenLabs TTS）
4. ✅ 测试管理后台

恭喜！你的签证面试模拟系统已经部署成功！🎉
